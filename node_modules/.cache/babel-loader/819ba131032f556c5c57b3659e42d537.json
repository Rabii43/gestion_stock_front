{"remainingRequest":"/home/terres-rabii/Documents/travail/OacaFront/node_modules/babel-loader/lib/index.js!/home/terres-rabii/Documents/travail/OacaFront/src/services/axiosHeader.js","dependencies":[{"path":"/home/terres-rabii/Documents/travail/OacaFront/src/services/axiosHeader.js","mtime":1652206760789},{"path":"/home/terres-rabii/Documents/travail/OacaFront/node_modules/cache-loader/dist/cjs.js","mtime":1647982849025},{"path":"/home/terres-rabii/Documents/travail/OacaFront/node_modules/babel-loader/lib/index.js","mtime":1648047804470}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgeyByZWZyZWNoZVRva2VuIH0gZnJvbSAiLi4vLi4vYXBpL2VudHJ5UG9pbnQiOwppbXBvcnQgVnVlIGZyb20gInZ1ZSI7CmltcG9ydCByb3V0ZXIgZnJvbSAiQC9yb3V0ZXIiOwppbXBvcnQgYXV0aFNlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvblNlcnZpY2UiOwp2YXIgYXBpID0gYXhpb3MuY3JlYXRlKHsKICBoZWFkZXJzOiB7CiAgICAiQXV0aG9yaXphdGlvbiI6ICJCZWFyZXIgIiArIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpLAogICAgIkFjY2VwdCI6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICJDb250ZW50LVR5cGUiOiAnYXBwbGljYXRpb24vanNvbicKICB9Cn0pOwphcGkuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICByZXR1cm4gcmVzcG9uc2U7Cn0sIGZ1bmN0aW9uIChlcnJvcikgewogIHZhciBvcmlnaW5hbENvbmZpZyA9IGVycm9yLmNvbmZpZzsKCiAgaWYgKGVycm9yLnJlc3BvbnNlKSB7CiAgICAvLyBBY2Nlc3MgVG9rZW4gd2FzIGV4cGlyZWQKICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMykgewogICAgICByb3V0ZXIucmVwbGFjZSh7CiAgICAgICAgcGF0aDogIi9sb2dpbiIsCiAgICAgICAgcXVlcnk6IHsKICAgICAgICAgIHJlZGlyZWN0OiByb3V0ZXIuY3VycmVudFJvdXRlLmZ1bGxQYXRoCiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgJiYgIW9yaWdpbmFsQ29uZmlnLl9yZXRyeSkgewogICAgICBvcmlnaW5hbENvbmZpZy5fcmV0cnkgPSB0cnVlOwogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAicmVmcmVzaF90b2tlbiI6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdyZWZyZXNoVG9rZW4nKQogICAgICB9OwogICAgICBhcGkucG9zdChyZWZyZWNoZVRva2VuLCBkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4ocmVzLmRhdGEudG9rZW4pOwogICAgICAgIGF1dGhTZXJ2aWNlLnNhdmVSZWZyZXNoVG9rZW4ocmVzLmRhdGEucmVmcmVzaF90b2tlbik7CiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgb3JpZ2luYWxDb25maWcuX3JldHJ5ID0gdHJ1ZTsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsKLyogaW50ZXJjZXB0b3JzIEF4aW9zICovCgpWdWUucHJvdG90eXBlLiRodHRwID0gYXBpOwphcGkuZGVmYXVsdHMudGltZW91dCA9IDEwMDAwOwphcGkuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChjb25maWcpIHsKICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oInRva2VuIikpIHsKICAgIHZhciB0b2tlbiA9ICJCZWFyZXIgIiArIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ0b2tlbiIpOwoKICAgIGlmICh0b2tlbikgewogICAgICBjb25maWcuaGVhZGVycy5jb21tb25bIkF1dGhvcml6YXRpb24iXSA9IHRva2VuOwogICAgfQoKICAgIHJldHVybiBjb25maWc7CiAgfQp9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsKZXhwb3J0IGRlZmF1bHQgYXBpOw=="},{"version":3,"sources":["/home/terres-rabii/Documents/travail/OacaFront/src/services/axiosHeader.js"],"names":["axios","refrecheToken","Vue","router","authService","api","create","headers","localStorage","getItem","interceptors","response","use","error","originalConfig","config","status","replace","path","query","redirect","currentRoute","fullPath","_retry","data","post","then","res","saveToken","token","saveRefreshToken","refresh_token","window","location","reload","err","Promise","reject","prototype","$http","defaults","timeout","request","common"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,aAAR,QAA4B,sBAA5B;AACA,OAAOC,GAAP,MAAgB,KAAhB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,WAAP,MAAwB,kCAAxB;AAEA,IAAMC,GAAG,GAAGL,KAAK,CAACM,MAAN,CAAa;AACrBC,EAAAA,OAAO,EAAE;AACL,qBAAiB,YAAYC,YAAY,CAACC,OAAb,CAAqB,OAArB,CADxB;AAEL,cAAU,kBAFL;AAGL,oBAAgB;AAHX;AADY,CAAb,CAAZ;AAQAJ,GAAG,CAACK,YAAJ,CAAiBC,QAAjB,CAA0BC,GAA1B,CACI,UAACD,QAAD,EAAc;AACV,SAAOA,QAAP;AACH,CAHL,EAII,UAACE,KAAD,EAAW;AACP,MAAMC,cAAc,GAAGD,KAAK,CAACE,MAA7B;;AACA,MAAIF,KAAK,CAACF,QAAV,EAAoB;AAChB;AACA,QAAIE,KAAK,CAACF,QAAN,CAAeK,MAAf,KAA0B,GAA9B,EAAmC;AAC/Bb,MAAAA,MAAM,CAACc,OAAP,CAAe;AACXC,QAAAA,IAAI,EAAE,QADK;AAEXC,QAAAA,KAAK,EAAE;AAACC,UAAAA,QAAQ,EAAEjB,MAAM,CAACkB,YAAP,CAAoBC;AAA/B;AAFI,OAAf;AAIH,KALD,MAKO,IAAIT,KAAK,CAACF,QAAN,CAAeK,MAAf,KAA0B,GAA1B,IAAiC,CAACF,cAAc,CAACS,MAArD,EAA6D;AAChET,MAAAA,cAAc,CAACS,MAAf,GAAwB,IAAxB;AACA,UAAIC,IAAI,GAAG;AAAC,yBAAiBhB,YAAY,CAACC,OAAb,CAAqB,cAArB;AAAlB,OAAX;AACAJ,MAAAA,GAAG,CAACoB,IAAJ,CAASxB,aAAT,EAAwBuB,IAAxB,EAA8BE,IAA9B,CACI,UAACC,GAAD,EAAS;AACLvB,QAAAA,WAAW,CAACwB,SAAZ,CAAsBD,GAAG,CAACH,IAAJ,CAASK,KAA/B;AACAzB,QAAAA,WAAW,CAAC0B,gBAAZ,CAA6BH,GAAG,CAACH,IAAJ,CAASO,aAAtC;AACAC,QAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB;AACH,OALL,EAMI,UAACC,GAAD,EAAS;AACLrB,QAAAA,cAAc,CAACS,MAAf,GAAwB,IAAxB;AACA,eAAOa,OAAO,CAACC,MAAR,CAAeF,GAAf,CAAP;AACH,OATL;AAWH;AACJ;;AACD,SAAOC,OAAO,CAACC,MAAR,CAAexB,KAAf,CAAP;AACH,CA9BL;AAiCA;;AACAX,GAAG,CAACoC,SAAJ,CAAcC,KAAd,GAAsBlC,GAAtB;AACAA,GAAG,CAACmC,QAAJ,CAAaC,OAAb,GAAuB,KAAvB;AAEApC,GAAG,CAACK,YAAJ,CAAiBgC,OAAjB,CAAyB9B,GAAzB,CACI,UAACG,MAAD,EAAY;AACR,MAAIP,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAJ,EAAmC;AAC/B,QAAMoB,KAAK,GAAG,YAAYrB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA1B;;AACA,QAAIoB,KAAJ,EAAW;AACPd,MAAAA,MAAM,CAACR,OAAP,CAAeoC,MAAf,CAAsB,eAAtB,IAAyCd,KAAzC;AACH;;AACD,WAAOd,MAAP;AACH;AACJ,CATL,EAUI,UAACF,KAAD,EAAW;AACP,SAAOuB,OAAO,CAACC,MAAR,CAAexB,KAAf,CAAP;AACH,CAZL;AAeA,eAAeR,GAAf","sourcesContent":["import axios from \"axios\";\nimport {refrecheToken} from \"../../api/entryPoint\";\nimport Vue from \"vue\";\nimport router from \"@/router\";\nimport authService from \"@/services/authenticationService\";\n\nconst api = axios.create({\n    headers: {\n        \"Authorization\": \"Bearer \" + localStorage.getItem('token'),\n        \"Accept\": 'application/json',\n        \"Content-Type\": 'application/json'\n    }\n});\n\napi.interceptors.response.use(\n    (response) => {\n        return response;\n    },\n    (error) => {\n        const originalConfig = error.config;\n        if (error.response) {\n            // Access Token was expired\n            if (error.response.status === 403) {\n                router.replace({\n                    path: \"/login\",\n                    query: {redirect: router.currentRoute.fullPath}\n                });\n            } else if (error.response.status === 401 && !originalConfig._retry) {\n                originalConfig._retry = true;\n                let data = {\"refresh_token\": localStorage.getItem('refreshToken')};\n                api.post(refrecheToken, data).then(\n                    (res) => {\n                        authService.saveToken(res.data.token);\n                        authService.saveRefreshToken(res.data.refresh_token);\n                        window.location.reload();\n                    },\n                    (err) => {\n                        originalConfig._retry = true;\n                        return Promise.reject(err);\n                    }\n                );\n            }\n        }\n        return Promise.reject(error);\n    }\n);\n\n/* interceptors Axios */\nVue.prototype.$http = api;\napi.defaults.timeout = 10000;\n\napi.interceptors.request.use(\n    (config) => {\n        if (localStorage.getItem(\"token\")) {\n            const token = \"Bearer \" + localStorage.getItem(\"token\");\n            if (token) {\n                config.headers.common[\"Authorization\"] = token;\n            }\n            return config;\n        }\n    },\n    (error) => {\n        return Promise.reject(error);\n    }\n);\n\nexport default api;"]}]}